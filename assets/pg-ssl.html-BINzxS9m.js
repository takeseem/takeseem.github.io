import{_ as t,c as e,b as i,e as a,d as n,f as h,a as p,r as k,o as r}from"./app-IivyIqoV.js";const d="/assets/pg-ssl-certs-Z1fxu7dh.png",g={},o={class:"hint-container tip"};function c(y,s){const l=k("RouteLink");return r(),e("div",null,[s[4]||(s[4]=i("h2",{id:"ssl-åŠ å¯†",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#ssl-åŠ å¯†"},[i("span",null,"SSL åŠ å¯†")])],-1)),i("div",o,[s[3]||(s[3]=i("p",{class:"hint-container-title"},"æç¤º",-1)),i("ul",null,[i("li",null,[s[1]||(s[1]=a("å…ˆé˜…è¯»ï¼š")),n(l,{to:"/code/net/ssl.html"},{default:h(()=>s[0]||(s[0]=[a("SSL/TLS åŠ å¯†")])),_:1}),s[2]||(s[2]=a("ï¼Œäº†è§£ ç§é’¥ã€è¯ä¹¦ã€è¯ä¹¦éªŒè¯ã€CAã€SAN ç­‰æ¦‚å¿µ"))])])]),s[5]||(s[5]=p('<ul><li><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.postgresql.org/docs/current/ssl-tcp.html" target="_blank" rel="noopener noreferrer">å®‰å…¨ TCP/IP è¿æ¥</a>ï¼Œå‚è€ƒæœ€åçš„è„šæœ¬ç”Ÿæˆè¯ä¹¦ï¼Œå†é…ç½®åå°±å¯ä»¥ä½¿ç”¨ SSL åŠ å¯†è¿æ¥ PostgreSQL äº†ã€‚</p></li><li><p>è¯ä¹¦ç­¾åç¤ºæ„å›¾ï¼š</p></li></ul><figure><img src="'+d+`" alt="è¯ä¹¦ç­¾åç¤ºæ„å›¾" width="50%" tabindex="0" loading="lazy"><figcaption>è¯ä¹¦ç­¾åç¤ºæ„å›¾</figcaption></figure><h2 id="ç”Ÿäº§ç¯å¢ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§ç¯å¢ƒé…ç½®"><span>ç”Ÿäº§ç¯å¢ƒé…ç½®</span></a></h2><ul><li>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨ CA æœºæ„é¢å‘çš„è¯ä¹¦ï¼Œä»¥ç¡®ä¿è¯ä¹¦çš„å®Œæ•´æ€§å’Œå¯é æ€§ã€‚</li><li>ä¸è¿‡ä½¿ç”¨è‡ªç­¾è¯ä¹¦ä¹Ÿæ˜¯å¯ä»¥çš„</li></ul><h2 id="é€šè®¯å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#é€šè®¯å®‰å…¨"><span>é€šè®¯å®‰å…¨</span></a></h2><ul><li>å†…ç½‘ï¼šå®‰å…¨é€šå¸¸ç”¨ç½‘ç»œæ§åˆ¶ï¼Œå—…æ¢é£é™©å°ï¼Œå¯ http é€šè®¯ï¼Œæ•°æ®åº“å¯é€‰ SSL ï¼ˆverify ca | fullï¼‰ä»…éªŒè¯æœåŠ¡å™¨</li><li>å¤–ç½‘ï¼šå› æµé‡èµ°å…¬ç½‘å­˜åœ¨å—…æ¢ç”šè‡³ä¸­é—´äººæ”»å‡»ï¼Œæ•…éœ€è¦ç¡®ä¿ï¼šé˜²çªƒå¬ + é˜² MITMï¼ˆä¸­é—´äººï¼‰ <ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦åŒå‘ verify-full | verify-ca</li></ul></li></ul><h2 id="æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦"><span>æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦</span></a></h2><ul><li><p>è¯ä¹¦è¯´æ˜</p><ul><li>DN è®¾ç½® -subj å‚æ•°è¯´æ˜ï¼š<code>/C=å›½å®¶/ST=çœ/L=åŸå¸‚/O=ç»„ç»‡/OU=éƒ¨é—¨æˆ–å•ä½/CN=æœåŠ¡çš„FQDNæˆ–å¸¸ç”¨å/emailAddress=é‚®ä»¶</code></li><li>DN ç¤ºä¾‹ï¼š<code>/O=demo/OU=prd/CN=root.prd.demo.com&quot;</code></li><li>prd.demo.com: <code>prd</code> ä»£è¡¨ç”Ÿäº§ç¯å¢ƒ</li><li>root æ ¹è¯ä¹¦ï¼š<code>/O=demo/OU=prd/CN=root.prd.demo.com</code></li><li>inter ä¸­é—´è¯ä¹¦ï¼š<code>/O=demo/OU=prd/CN=inter.prd.demo.com</code></li></ul></li><li><p>åˆ›å»ºæ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦è„šæœ¬</p><ul><li>ç”Ÿæˆ root.prd å’Œ intr.prd è¯ä¹¦ï¼Œï¼ˆä¸ºä»€ä¹ˆè®¾ç½® 20 å¹´ï¼Ÿä¸€æ˜¯çœäº‹ï¼ŒäºŒæ˜¯ 20 å¹´åéƒ½é€€ä¼‘äº†ğŸ˜¸ï¸ï¼‰</li><li><code>root.prd.key</code> ä¸€å®šè¦è®¾ç½®å¯†ç ï¼Œé˜²æ­¢æ³„éœ²ï¼Œå¹¶æ”¾åœ¨å®‰å…¨çš„åœ°æ–¹ã€‚</li><li><code>inter.prd.key</code> ä¹Ÿè¦è®¾ç½®å¯†ç ï¼Œå¹¶æ”¾åœ¨å®‰å…¨çš„åœ°æ–¹ã€‚ä¸­é—´è¯ä¹¦æ˜¯ä¸€ç§å®‰å…¨éš”ç¦»ï¼Œä¸€æ˜¯ä¿è¯æ ¹è¯ä¹¦çš„å®‰å…¨æ€§ï¼ŒäºŒæ˜¯ä¾¿äºç­¾ç½²æœåŠ¡å™¨è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦ã€‚</li><li><code>chattr +i</code> é”å®šæ–‡ä»¶ï¼Œé˜²æ­¢è¯¯åˆ å’Œä¿®æ”¹ã€‚</li></ul></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># root</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -new</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -subj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/O=demo/OU=prd/CN=root.prd.demo.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7400</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -extfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/ssl/openssl.cnf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -extensions</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v3_ca</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -signkey</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.crt</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## é”å®šæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.csr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.crt</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## æ£€æŸ¥é”å®šçŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lsattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¸­é—´è¯ä¹¦ inter</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -new</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -subj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/O=demo/OU=prd/CN=inter.prd.demo.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7350</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -extfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/ssl/openssl.cnf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -extensions</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v3_ca</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.crt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CAkey</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CAcreateserial</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.crt</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## é”å®šæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.csr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.crt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lsattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="postgres-æœåŠ¡å™¨è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#postgres-æœåŠ¡å™¨è¯ä¹¦"><span>postgres æœåŠ¡å™¨è¯ä¹¦</span></a></h2><ul><li>æœåŠ¡å™¨è¯ä¹¦ä¸­ pg è¡¨ç¤º postgresï¼Œ*.pg ç”¨äºæ ‡è¯†ä¸åŒçš„ pg å®ä¾‹</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœé…ç½®äº† SANï¼ŒCN å°†ä¸èµ·ä½œç”¨ï¼Œæ‰€ä»¥å¦‚è¦æ”¯æŒ CNï¼ŒCN ä¹Ÿè¦åŒ…å«åœ¨ SAN ä¸­</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -new</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -nodes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -subj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/O=demo/OU=prd.pg/CN=pg.prd.demo.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.crt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CAkey</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CAcreateserial</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.crt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -extfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &lt;(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">printf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;subjectAltName=DNS:*.pg.prd.demo.com,DNS:pg.prd.demo.com&quot;)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## ç”Ÿæˆè¯ä¹¦é“¾</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.crt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.crt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pg.prd-all.crt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.csr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.prd.crt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lsattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é…ç½®-postgres-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#é…ç½®-postgres-æœåŠ¡å™¨"><span>é…ç½® postgres æœåŠ¡å™¨</span></a></h2><ul><li>ä¿®æ”¹ <code>postgresql.conf</code> å¯ç”¨ SSLã€é…ç½®è¯ä¹¦ root.prd.crtï¼Œpg.prd.key, pg.prd-all.crt</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl_ca_file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;/etc/postgresql/ssl/root.prd.crt&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl_cert_file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;/etc/postgresql/ssl/pg.prd-all.crt&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl_key_file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;/etc/postgresql/ssl/pg.prd.key&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## ä½¿ç”¨ HIGH åŠ å¯†å¼ºåº¦ï¼Œä¸å…è®¸ NULLã€MD5 åŠ å¯†</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl_ciphers</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;HIGH:!aNULL:!MD5&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## æœåŠ¡å™¨ç«¯è¯ä¹¦éªŒè¯æ¨¡å¼é…ç½®ä¼˜å…ˆ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl_prefer_server_ciphers</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## æ¤­åœ†æ›²çº¿(ECDH)å¯†é’¥äº¤æ¢ç®—æ³•çš„é€‰æ‹©</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl_ecdh_curve</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;prime256v1&#39;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssl_min_protocol_version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;TLSv1.2&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¿®æ”¹ <code>pg_hba.conf</code> é…ç½® ssl è®¤è¯ï¼š<code>hostssl all all all scram-sha-256 clientcert=verify-full</code></li></ul><h2 id="å®¢æˆ·ç«¯è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯è¯ä¹¦"><span>å®¢æˆ·ç«¯è¯ä¹¦</span></a></h2><ul><li>ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦ï¼šæ•°æ®åº“ç™»å½•ç”¨æˆ·æ˜¯ä»€ä¹ˆï¼ŒCN å°±å¿…é¡»æ˜¯ä»€ä¹ˆï¼Œå¦‚ï¼šmyuser</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -new</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -nodes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -subj</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/O=demo/OU=prd.pg.client/CN=myuser&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -req</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -text</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -days</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.crt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CAkey</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -CAcreateserial</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.crt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.crt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inter.prd.crt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pg.client.myuser-all.crt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.csr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.prd.crt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lsattr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pg.client.myuser.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é…ç½®å®¢æˆ·ç«¯è¿æ¥" tabindex="-1"><a class="header-anchor" href="#é…ç½®å®¢æˆ·ç«¯è¿æ¥"><span>é…ç½®å®¢æˆ·ç«¯è¿æ¥</span></a></h2><ul><li>é…ç½®ï¼šroot.prd.crtï¼Œpg.client.myuser.key, pg.client.myuser-all.crt</li><li><a href="https://jdbc.postgresql.org/documentation/use/#connection-parameters" target="_blank" rel="noopener noreferrer">JDBC è¿æ¥å‚æ•°</a>ï¼š</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ssl=true&amp;sslmode=verify-full&amp;sslcert=pg.client.myuser-all.crt&amp;sslkey=pg.client.myuser.key&amp;sslrootcert=root.prd.crt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,22))])}const F=t(g,[["render",c],["__file","pg-ssl.html.vue"]]),u=JSON.parse('{"path":"/code/pg/pg-ssl.html","title":"PostgreSQL é…ç½® SSL","lang":"zh-CN","frontmatter":{"title":"PostgreSQL é…ç½® SSL","icon":"fa-brands fa-expeditedssl","date":"2024-11-13T11:26:57.000Z","category":["æ¶æ„","postgres"],"tag":["æ¶æ„","postgres","SSL"],"order":10,"star":true,"description":"SSL åŠ å¯† æç¤º å…ˆé˜…è¯»ï¼šï¼Œäº†è§£ ç§é’¥ã€è¯ä¹¦ã€è¯ä¹¦éªŒè¯ã€CAã€SAN ç­‰æ¦‚å¿µ æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼šå®‰å…¨ TCP/IP è¿æ¥ï¼Œå‚è€ƒæœ€åçš„è„šæœ¬ç”Ÿæˆè¯ä¹¦ï¼Œå†é…ç½®åå°±å¯ä»¥ä½¿ç”¨ SSL åŠ å¯†è¿æ¥ PostgreSQL äº†ã€‚ è¯ä¹¦ç­¾åç¤ºæ„å›¾ï¼š è¯ä¹¦ç­¾åç¤ºæ„å›¾è¯ä¹¦ç­¾åç¤ºæ„å›¾ ç”Ÿäº§ç¯å¢ƒé…ç½® ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨ CA æœºæ„é¢å‘çš„è¯ä¹¦ï¼Œä»¥ç¡®ä¿è¯ä¹¦çš„å®Œæ•´æ€§å’Œå¯é æ€§ã€‚ ä¸è¿‡ä½¿ç”¨...","head":[["meta",{"property":"og:url","content":"https://www.takeseem.com/code/pg/pg-ssl.html"}],["meta",{"property":"og:site_name","content":"å…¨çƒæŒ‡æ•°"}],["meta",{"property":"og:title","content":"PostgreSQL é…ç½® SSL"}],["meta",{"property":"og:description","content":"SSL åŠ å¯† æç¤º å…ˆé˜…è¯»ï¼šï¼Œäº†è§£ ç§é’¥ã€è¯ä¹¦ã€è¯ä¹¦éªŒè¯ã€CAã€SAN ç­‰æ¦‚å¿µ æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼šå®‰å…¨ TCP/IP è¿æ¥ï¼Œå‚è€ƒæœ€åçš„è„šæœ¬ç”Ÿæˆè¯ä¹¦ï¼Œå†é…ç½®åå°±å¯ä»¥ä½¿ç”¨ SSL åŠ å¯†è¿æ¥ PostgreSQL äº†ã€‚ è¯ä¹¦ç­¾åç¤ºæ„å›¾ï¼š è¯ä¹¦ç­¾åç¤ºæ„å›¾è¯ä¹¦ç­¾åç¤ºæ„å›¾ ç”Ÿäº§ç¯å¢ƒé…ç½® ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨ CA æœºæ„é¢å‘çš„è¯ä¹¦ï¼Œä»¥ç¡®ä¿è¯ä¹¦çš„å®Œæ•´æ€§å’Œå¯é æ€§ã€‚ ä¸è¿‡ä½¿ç”¨..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-16T12:14:26.000Z"}],["meta",{"property":"article:tag","content":"æ¶æ„"}],["meta",{"property":"article:tag","content":"postgres"}],["meta",{"property":"article:tag","content":"SSL"}],["meta",{"property":"article:published_time","content":"2024-11-13T11:26:57.000Z"}],["meta",{"property":"article:modified_time","content":"2024-11-16T12:14:26.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"PostgreSQL é…ç½® SSL\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-11-13T11:26:57.000Z\\",\\"dateModified\\":\\"2024-11-16T12:14:26.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"å…¨çƒæŒ‡æ•°\\",\\"url\\":\\"https://www.takeseem.com\\"}]}"]]},"headers":[{"level":2,"title":"SSL åŠ å¯†","slug":"ssl-åŠ å¯†","link":"#ssl-åŠ å¯†","children":[]},{"level":2,"title":"ç”Ÿäº§ç¯å¢ƒé…ç½®","slug":"ç”Ÿäº§ç¯å¢ƒé…ç½®","link":"#ç”Ÿäº§ç¯å¢ƒé…ç½®","children":[]},{"level":2,"title":"é€šè®¯å®‰å…¨","slug":"é€šè®¯å®‰å…¨","link":"#é€šè®¯å®‰å…¨","children":[]},{"level":2,"title":"æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦","slug":"æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦","link":"#æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦","children":[]},{"level":2,"title":"postgres æœåŠ¡å™¨è¯ä¹¦","slug":"postgres-æœåŠ¡å™¨è¯ä¹¦","link":"#postgres-æœåŠ¡å™¨è¯ä¹¦","children":[]},{"level":2,"title":"é…ç½® postgres æœåŠ¡å™¨","slug":"é…ç½®-postgres-æœåŠ¡å™¨","link":"#é…ç½®-postgres-æœåŠ¡å™¨","children":[]},{"level":2,"title":"å®¢æˆ·ç«¯è¯ä¹¦","slug":"å®¢æˆ·ç«¯è¯ä¹¦","link":"#å®¢æˆ·ç«¯è¯ä¹¦","children":[]},{"level":2,"title":"é…ç½®å®¢æˆ·ç«¯è¿æ¥","slug":"é…ç½®å®¢æˆ·ç«¯è¿æ¥","link":"#é…ç½®å®¢æˆ·ç«¯è¿æ¥","children":[]}],"git":{"createdTime":1731483454000,"updatedTime":1731759266000,"contributors":[{"name":"takeseem","email":"takeseem@gmail.com","commits":1}]},"readingTime":{"minutes":2.91,"words":873},"filePathRelative":"code/pg/pg-ssl.md","localizedDate":"2024å¹´11æœˆ13æ—¥","excerpt":"<h2>SSL åŠ å¯†</h2>\\n<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">æç¤º</p>\\n<ul>\\n<li>å…ˆé˜…è¯»ï¼š<a href=\\"/code/net/ssl.html\\" target=\\"_blank\\">SSL/TLS åŠ å¯†</a>ï¼Œäº†è§£ ç§é’¥ã€è¯ä¹¦ã€è¯ä¹¦éªŒè¯ã€CAã€SAN ç­‰æ¦‚å¿µ</li>\\n</ul>\\n</div>\\n<ul>\\n<li>\\n<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼š<a href=\\"https://www.postgresql.org/docs/current/ssl-tcp.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">å®‰å…¨ TCP/IP è¿æ¥</a>ï¼Œå‚è€ƒæœ€åçš„è„šæœ¬ç”Ÿæˆè¯ä¹¦ï¼Œå†é…ç½®åå°±å¯ä»¥ä½¿ç”¨ SSL åŠ å¯†è¿æ¥ PostgreSQL äº†ã€‚</p>\\n</li>\\n<li>\\n<p>è¯ä¹¦ç­¾åç¤ºæ„å›¾ï¼š</p>\\n</li>\\n</ul>","autoDesc":true}');export{F as comp,u as data};
